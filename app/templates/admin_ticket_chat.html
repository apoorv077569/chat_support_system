<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Chat - Admin</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        body { background-color: #eef2f6; }
        #chatBox {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: white;
            border-radius: 12px;
        }
        .msg {
            padding: 10px 15px;
            border-radius: 12px;
            margin-bottom: 8px;
            max-width: 60%;
        }
        .user {
            background: #d1e7ff;
            align-self: flex-start;
        }
        .admin {
            background: #c8ffc9;
            align-self: flex-end;
        }
    </style>
</head>

<body class="p-4">
    <h2 class="fw-bold">Ticket Conversation</h2>
    <div id="chatBox" class="d-flex flex-column"></div>

    <script type="module">
        const ticketId = "{{ ticket_id }}";
        const token = localStorage.getItem("admin_token");

        async function loadChat() {
            const res = await fetch(`/api/admin/messages/${ticketId}`, {
                headers: { "Authorization": "Bearer " + token }
            });

            const data = await res.json();
            const chatBox = document.getElementById("chatBox");

            data.messages.forEach(m => {
                const div = document.createElement("div");

                div.classList.add("msg");
                div.classList.add(m.sender_id == 0 ? "admin" : "user");

                div.textContent = `${m.sender_id == 0 ? "Admin" : "User"}: ${m.message}`;

                chatBox.appendChild(div);
            });
        }
        loadChat();
    </script>
</body>
</html>
